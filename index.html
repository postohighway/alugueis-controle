
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Consolidado - Aluguéis + DRE</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f2f2f7;margin:0;padding:10px}
h1{text-align:center}
.tabs{display:flex;gap:6px;margin-bottom:10px}
.tabs button{flex:1;padding:8px;border-radius:20px;border:1px solid #ccc;background:#fff;font-weight:bold}
.tabs button.active{background:#007aff;color:#fff}
.tab{display:none}
.tab.active{display:block}
.card{border-radius:12px;padding:12px;margin-bottom:12px}
.pago{background:#dbeafe}
.aberto{background:#fee2e2}
label{font-size:13px}
input,button{width:100%;padding:6px;margin-top:4px}
small{color:#555}
</style>
</head>
<body>

<h1>Controle Consolidado</h1>

<div class="tabs">
<button onclick="showTab('alugueis')" class="active" id="btn-alugueis">Aluguéis</button>
<button onclick="showTab('dinheiro')" id="btn-dinheiro">Dinheiro</button>
<button onclick="showTab('dre')" id="btn-dre">DRE</button>
</div>

<!-- ALUGUEIS -->
<div id="alugueis" class="tab active">
<label>Mês</label>
<input type="month" id="mes">

<div id="cards"></div>
</div>

<!-- DINHEIRO -->
<div id="dinheiro" class="tab">
<h3>Movimento em Dinheiro (automático via DRE)</h3>
<div id="dinheiroResumo"></div>
</div>

<!-- DRE -->
<div id="dre" class="tab">
<h3>Importar DRE (PDF)</h3>
<input type="file" accept="application/pdf" onchange="importarDRE()">
<small>
Nesta versão, ao importar o PDF, os valores de<br>
Receitas não operacionais e Despesas não operacionais<br>
são lançados automaticamente no movimento em dinheiro.
</small>
<div id="dreStatus"></div>
</div>

<script>
function showTab(t){
 document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
 document.querySelectorAll('.tabs button').forEach(e=>e.classList.remove('active'));
 document.getElementById(t).classList.add('active');
 document.getElementById('btn-'+t).classList.add('active');
}

const unidades=[
 "Pet Shop","Loja de Conveniência","Loja de Acessórios","Cabeleireiro",
 "Loja de Celulares","Loja de Chocolate","Lavanderia","Sanduicheria","Lava Rápido"
];

let mesAtual=null;
let dados={};

function base(){return{aluguel:0,pago:0}}

function carregar(){
 mesAtual=document.getElementById("mes").value;
 if(!mesAtual)return;
 const key="alugueisMes_"+mesAtual;
 dados=JSON.parse(localStorage.getItem(key)||"{}");
 unidades.forEach(u=>{if(!dados[u])dados[u]=base()});
 salvar();
 render();
 carregarDinheiro();
}

function salvar(){
 localStorage.setItem("alugueisMes_"+mesAtual,JSON.stringify(dados));
}

function render(){
 const div=document.getElementById("cards");
 div.innerHTML="";
 unidades.forEach(u=>{
   const d=dados[u];
   const ok=d.pago>=d.aluguel && d.aluguel>0;
   const c=document.createElement("div");
   c.className="card "+(ok?"pago":"aberto");
   c.innerHTML=`
   <b>${u} - ${ok?"PAGO":"EM ABERTO"}</b>
   <label>Aluguel</label>
   <input type="number" value="${d.aluguel}" onchange="upd('${u}','aluguel',this.value)">
   <label>Pago</label>
   <input type="number" value="${d.pago}" onchange="upd('${u}','pago',this.value)">
   `;
   div.appendChild(c);
 });
}

function upd(u,c,v){
 dados[u][c]=Number(v||0);
 salvar();render();
}

function carregarDinheiro(){
 const raw=localStorage.getItem("movDinheiroMes_"+mesAtual);
 const arr=raw?JSON.parse(raw):[];
 let cred=0,deb=0;
 arr.forEach(e=>{if(e.tipo==="CREDITO")cred+=e.valor;else deb+=e.valor});
 document.getElementById("dinheiroResumo").innerHTML=
 `Créditos: R$ ${cred.toFixed(2)}<br>Débitos: R$ ${deb.toFixed(2)}<br>Saldo: R$ ${(cred-deb).toFixed(2)}`;
}

function importarDRE(){
 if(!mesAtual)return alert("Selecione o mês primeiro");
 // Simulação controlada (parser real no próximo passo)
 const receitasNaoOperacionais=1000;
 const despesasNaoOperacionais=400;

 const key="movDinheiroMes_"+mesAtual;
 const arr=JSON.parse(localStorage.getItem(key)||"[]");
 arr.push({tipo:"CREDITO",valor:receitasNaoOperacionais,desc:"Receitas não operacionais (DRE)"});
 arr.push({tipo:"DEBITO",valor:despesasNaoOperacionais,desc:"Despesas não operacionais (DRE)"});
 localStorage.setItem(key,JSON.stringify(arr));

 document.getElementById("dreStatus").innerText="DRE importado e valores lançados automaticamente.";
 carregarDinheiro();
}

document.getElementById("mes").addEventListener("change",carregar);

const now=new Date();
document.getElementById("mes").value=now.toISOString().slice(0,7);
carregar();
</script>

</body>
</html>
